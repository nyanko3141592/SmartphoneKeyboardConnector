了解。スマホの「12 キー（ケータイ配列）フリック」の“配列と出力”を、実装しやすいようにテキスト仕様でまとめます。
（画像は一般的な Gboard 風。機種や IME で句読点/かっこ等の割当が少しだけ変わりますが、**かな行の規則**は共通です。）

# 1) 物理配置（3×4 のかなキー）

上から順に 4 行、左から 3 列。

```
[1,1] あ   [1,2] か   [1,3] さ
[2,1] た   [2,2] な   [2,3] は
[3,1] ま   [3,2] や   [3,3] ら
[4,1] わ   [4,2]（小/゛/゜ 系の複合キー or を/長音/小文字）
[4,3] 句読点/記号/確定周辺（IMEにより変動）
```

※ 左端/右端には機能キー（削除・スペース/変換・改行/送信・音声入力・数字切替〈“123”〉・あ A 切替 など）が並ぶ。ここは IME 差が大きいので後述の概念だけ押さえれば OK。

# 2) フリック規則（全行共通の基本）

各キーは **中心＝ a、→ ＝ i、↑ ＝ u、↓ ＝ e、← ＝ o** の規則で母音が切り替わります。
（タップ連打で a→i→u→e→o と巡回入力する実装も一般的）

例（共通ルール）

```
中心: 子音+a
→:   子音+i
↑:   子音+u
↓:   子音+e
←:   子音+o
```

# 3) 各キーの出力テーブル（かな行）

**完全に規則化**されるので、下記をそのまま辞書化できます。

- \[1,1] 「あ」行

  - 中心 あ / → い / ↑ う / ↓ え / ← お

- \[1,2] 「か」行

  - 中心 か / → き / ↑ く / ↓ け / ← こ

- \[1,3] 「さ」行

  - 中心 さ / → し / ↑ す / ↓ せ / ← そ

- \[2,1] 「た」行

  - 中心 た / → ち / ↑ つ / ↓ て / ← と

- \[2,2] 「な」行

  - 中心 な / → に / ↑ ぬ / ↓ ね / ← の

- \[2,3] 「は」行

  - 中心 は / → ひ / ↑ ふ / ↓ へ / ← ほ

- \[3,1] 「ま」行

  - 中心 ま / → み / ↑ む / ↓ め / ← も

- \[3,2] 「や」行（**欠番 i,e**）

  - 中心 や / ↑ ゆ / ← よ
  - （→,↓ は IME 依存で括弧「（」「）」等に割当てる実装が多い）

- \[3,3] 「ら」行

  - 中心 ら / → り / ↑ る / ↓ れ / ← ろ

- \[4,1] 「わ」行（**を・ん を同居させる慣例**）

  - 中心 わ / （どこかに）を / （どこかに）ん
  - 代表例：→ を、↑ ん、↓ ゎ（小）、← ー or 〜（IME 差あり）

- \[4,2] 補助キー領域（Gboard など）

  - フリック左：゛（濁点）／右：゜（半濁点）／上：小（大 ⇔ 小）
  - 中心タップで「小」トグル（直前の仮名を小書き化）等

- \[4,3] 句読点/記号クラスタ（IME 差）

  - 「、」「。」を中心に、フリックで「？」「！」「…」「ー」「～」など

> 実装のコツ：**\[あ/か/さ/た/な/は/ま/ら] 行は完全機械化**できます。
> 特例は \*\*や行（i,e 欠番）\*\*と **わ行（を・ん混在）**、そして **下段の補助/記号キー**のみ。

# 4) 変換系ルール（入力後処理）

実装で迷いがちな部分を仕様化します。

## 4.1 濁点・半濁点（直前文字の置換）

- 入力「゛」→ 変換表：か → が、き → ぎ、…／さ → ざ、し → じ、…／た → だ、ち → ぢ、つ → づ、…／は → ば、ひ → び、…／**う → ゔ**
- 入力「゜」→ 変換表：は → ぱ、ひ → ぴ、ふ → ぷ、へ → ぺ、ほ → ぽ
- 直前が対象外ならそのまま挿入（多くの IME は無視 or 記号入力を選択）

## 4.2 小書き化（直前文字の置換）

- 対象例：あ → ぁ、い → ぃ、う → ぅ、え → ぇ、お → ぉ、や → ゃ、ゆ → ゅ、よ → ょ、つ → っ、わ → ゎ
- **ゃゅょ**は拗音（き＋ゃ →「きゃ」など）でよく使う。
  実装は「小」トグル or 個別マッピングのどちらでも可。

## 4.3 促音「っ」

- 方式 A：**つ**入力後に「小」変換 → っ
- 方式 B：**た**キー ↑ で「つ」入力後、長押し/連打でっ、または専用ショートカット
- 方式 C：子音重ね規則（次キーの子音が促音可能なら自動で「っ」を前置）※任意仕様

## 4.4 撥音「ん」

- 多くの IME で **わ行キー**に同居（↑ など）。
- ローマ字的あいまいさがないため **単独確定**で OK（後続が母音でも分離される）。

## 4.5 長音「ー」

- 右下周辺に配置されることが多い（\[4,1]← や \[4,3] の一部に割当）
- カタカナ入力時は特に多用。ひらがなでもそのまま「ー」を挿入。

# 5) 記号と括弧（よくある割当）

- **やキー**の空き（i,e）に **（ ）** を置く実装が一般的（左右対称で覚えやすい）
- 右端クラスタに **、。？！…**、長押しで **；：・／—** 等を多重割当
- 下部の **“123”** で数字/記号層へページ切替（別レイヤ定義）

# 6) 入力ジェスチャの挙動（UI/UX 仕様）

- **フリック＝押下開始キーを起点に、指を離した方向で確定（ホールド中プレビュー）**
- **タップ＝中心（a）**。連打で母音ローテーションを許可する実装もあり
- **長押し＝サブパレット**（小書き/記号/絵文字/候補）を出す IME もある
- **オートリピート**：句読点/伸ばし棒などは長押しで連続入力

# 7) 参考となる最小データ構造（疑似）

```json
{
  "あ": {
    "center": "あ",
    "right": "い",
    "up": "う",
    "down": "え",
    "left": "お"
  },
  "か": {
    "center": "か",
    "right": "き",
    "up": "く",
    "down": "け",
    "left": "こ"
  },
  "さ": {
    "center": "さ",
    "right": "し",
    "up": "す",
    "down": "せ",
    "left": "そ"
  },
  "た": {
    "center": "た",
    "right": "ち",
    "up": "つ",
    "down": "て",
    "left": "と"
  },
  "な": {
    "center": "な",
    "right": "に",
    "up": "ぬ",
    "down": "ね",
    "left": "の"
  },
  "は": {
    "center": "は",
    "right": "ひ",
    "up": "ふ",
    "down": "へ",
    "left": "ほ"
  },
  "ま": {
    "center": "ま",
    "right": "み",
    "up": "む",
    "down": "め",
    "left": "も"
  },
  "や": {
    "center": "や",
    "up": "ゆ",
    "left": "よ",
    "right": "（）枠",
    "down": "（）枠"
  },
  "ら": {
    "center": "ら",
    "right": "り",
    "up": "る",
    "down": "れ",
    "left": "ろ"
  },
  "わ": {
    "center": "わ",
    "right": "を",
    "up": "ん",
    "down": "ゎ",
    "left": "ー"
  },
  "mods": {
    "dakuten": "゛",
    "handakuten": "゜",
    "small": "小",
    "long_dash": "ー"
  }
}
```

---

このまま実装に落とし込めます。
もしターゲット IME（iOS 日本語/Gboard/Simeji など）に**完全一致**させたい場合は、下段の「わ・や・記号」周りだけ微調整すれば OK。必要なら、その IME 名を指定してもらえれば、差分テーブルで出します。
